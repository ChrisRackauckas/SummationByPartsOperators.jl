using SymPy
N = 11
b = [symbols("b_$i", real=true) for i in 1:N]

# order 2
h = [1//2, 1, 1, 1]
H = Diagonal(h)

s = [-3//2, 2, -1//2, 0]

m1 = [(b[1]+b[2])/2, -(b[1]+b[2])/2, 0, 0]
m2 = [-(b[1]+b[2])/2, b[1]/2+b[2]+b[3]/2, -(b[2]+b[3])/2, 0]
m3 = [0, -(b[2]+b[3])/2, b[2]/2+b[3]+b[4]/2, -(b[3]+b[4])/2]
m4 = [0, 0, -(b[3]+b[4])/2, b[3]/2+b[4]+b[5]/2]
M = hcat(m1, m2, m3, m4)'

S = zeros(M)
S[1,:] = s

D2 = H \ (-M - b[1]*S)


# order 4
h = [17//48, 59//48, 43//48, 49//48, 1, 1, 1, 1]
H = Diagonal(h)

s = [-11//6, 3, -3//2, 1//3, 0, 0, 0, 0]

m1 = [12*b[1]//17 + 59//192*b[2] + 27010400129//345067064608*b[3] + 69462376031//2070402387648*b[4],
    -59//68*b[1] - 6025413881//21126554976*b[3] - 537416663//7042184992*b[4],
    2//17*b[1] - 59//192*b[2] + 213318005//16049630912*b[4]+2083938599//8024815456*b[3],
    3//68*b[1] - 1244724001//21126554976*b[3] + 752806667//21126554976*b[4],
    49579087//10149031312*b[3] - 49579087//10149031312*b[4],
    -1//784*b[4]+1//784*b[3],
    0, 0]
m2 = [m1[2],
    3481//3264*b[1] + BigInt(9258282831623875)//7669235228057664*b[3] + 236024329996203//1278205871342944*b[4],
    -59//408*b[1] - 29294615794607//29725717938208*b[3] - 2944673881023//29725717938208*b[4],
    -59//1088*b[1] + 260297319232891//2556411742685888*b[3] - 60834186813841//1278205871342944*b[4],
    -1328188692663//37594290333616*b[3] + 1328188692663//37594290333616*b[4],
    -8673//2904112*b[3] + 8673//2904112*b[4],
    0, 0]
m3 = [m1[3], m2[3],
    1//51*b[1] + 59//192*b[2] + 13777050223300597//26218083221499456*b[4] + 564461//13384296*b[5] + BigInt(378288882302546512209)//270764341349677687456*b[3],
    1//136*b[1] - 125059//743572*b[5] - 4836340090442187227//5525802884687299744*b[3] - 17220493277981//89177153814624*b[4],
    -10532412077335//42840005263888*b[4] + 1613976761032884305//7963657098519931984*b[3] + 564461//4461432*b[5],
    -960119//1280713392*b[4] - 3391//6692148*b[5] + 33235054191//26452850508784*b[3],
    0, 0]
m4 = [m1[4], m2[4], m3[4],
    3//1088*b[1] + BigInt(507284006600757858213)//475219048083107777984*b[3] + 1869103//2230716*b[5] + 1//24*b[6] + 1950062198436997//3834617614028832*b[4],
    -BigInt(4959271814984644613)//20965546238960637264*b[3] - 1//6*b[6] - 15998714909649//37594290333616*b[4] - 375177//743572*b[5],
    -368395//2230716*b[5] + 752806667//539854092016*b[3] + 1063649//8712336*b[4] + 1//8*b[6],
    0, 0]
m5 = [m1[5], m2[5], m3[5], m4[5],
    BigInt(8386761355510099813)//128413970713633903242*b[3] + 2224717261773437//2763180339520776*b[4] + 5//6*b[6] + 1//24*b[7] + 280535//371786*b[5],
    -35039615//213452232*b[4] - 1//6*b[7] - 13091810925//13226425254392*b[3] - 1118749//2230716*b[5] - 1//2*b[6],
    -1//6*b[6] + 1//8*b[5] + 1//8*b[7],
    0]
m6 = [m1[6], m2[6], m3[6], m4[6], m5[6],
    3290636//80044587*b[4] + 5580181//6692148*b[5] + 5//6*b[7] + 1//24*b[8] + 660204843//13226425254392*b[3] + 3//4*b[6],
    -1//6*b[5] - 1//6*b[8] - 1//2*b[6] - 1//2*b[7],
    -1//6*b[7] + 1//8*b[6] + 1//8*b[8]]
i=7; m7 = -[0, 0, 0, 0,
    b[i-1]/6 - b[i-2]/8 - b[i]/8,
    b[i-2]/6 + b[i+1]/6 + b[i-1]/2 + b[i]/2,
    -b[i-2]/24 - 5*b[i-1]/6 - 5*b[i+1]/6 - b[i+2]/24 - 3*b[i]/4,
    b[i-1]/6 + b[i+2]/6 + b[i]/2 + b[i+1]/2,
    #b[i+1]/6 - b[i]/8 - b[i+2]/8
    ]
i=8; m8 = -[0, 0, 0, 0, 0,
    b[i-1]/6 - b[i-2]/8 - b[i]/8,
    b[i-2]/6 + b[i+1]/6 + b[i-1]/2 + b[i]/2,
    -b[i-2]/24 - 5*b[i-1]/6 - 5*b[i+1]/6 - b[i+2]/24 - 3*b[i]/4,
    #b[i-1]/6 + b[i+2]/6 + b[i]/2 + b[i+1]/2,
    #b[i+1]/6 - b[i]/8 - b[i+2]/8
    ]
M = hcat(m1, m2, m3, m4, m5, m6, m7, m8)'

S = zeros(M)
S[1,:] = s

D2 = H \ (-M - b[1]*S)
